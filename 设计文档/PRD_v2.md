# NexusQA 产品需求文档 (PRD)

---

## 文档信息

| 项目 | 内容 |
|------|------|
| **文档版本** | 2.0 |
| **产品名称** | NexusQA |
| **文档作者** | 产品团队 |
| **创建日期** | 2025-11-26 |
| **最后更新** | 2025-11-30 |
| **文档状态** | 草稿 |

### 变更记录

| 版本 | 日期 | 作者 | 变更内容 |
|------|------|------|---------|
| 1.0 | 2025-11-26 | - | 初始版本 |
| 2.0 | 2025-11-26 | - | 重构：增加用户场景、验收标准、风险分析 |
| 2.1 | 2025-11-30 | - | 更新需求管理模块状态：F-RQ-001~006, 011~012 已完成 |

### 审批记录

| 角色 | 姓名 | 审批日期 | 状态 |
|------|------|---------|------|
| 产品负责人 | - | - | 待审批 |
| 技术负责人 | - | - | 待审批 |
| 测试负责人 | - | - | 待审批 |

---

## 目录

1. [产品概述](#1-产品概述)
2. [目标用户](#2-目标用户)
3. [用户场景](#3-用户场景)
4. [功能需求](#4-功能需求)
5. [非功能需求](#5-非功能需求)
6. [约束与假设](#6-约束与假设)
7. [风险与依赖](#7-风险与依赖)
8. [API 设计](#8-api-设计)
9. [版本规划](#9-版本规划)
10. [成功指标](#10-成功指标)
11. [附录](#11-附录)

---

## 1. 产品概述

### 1.1 背景与问题

#### 行业现状

软件测试管理是软件开发流程中的关键环节。当前市场上的测试管理工具存在以下问题：

| 问题类别 | 具体表现 | 影响 |
|---------|---------|------|
| **工具割裂** | 用例管理、执行记录、缺陷跟踪分散在不同系统 | 数据无法追溯，协作效率低 |
| **上手成本高** | 企业级工具（TestRail、ALM）配置复杂 | 中小团队难以快速落地 |
| **智能化不足** | 测试用例仍需人工逐条编写 | 用例编写占用大量时间 |
| **本地化欠缺** | 国外工具中文支持差，不符合国内团队习惯 | 使用体验不佳 |

#### 目标用户痛点

通过用户调研，识别出以下核心痛点：

| 痛点 | 描述 | 用户反馈摘要 |
|------|------|-------------|
| **P1: 用例编写耗时** | 一个完整用例平均需要 10-15 分钟编写 | "每次写用例都像写作文" |
| **P2: 执行结果难追溯** | 无法快速查看某用例的历史执行情况 | "上次这个用例什么时候通过的？" |
| **P3: 缺陷流转不透明** | 缺陷提交后不知道处理进度 | "Bug 提了一周了，没人管" |
| **P4: 回归测试重复劳动** | 每次回归都要重新组织用例 | "能不能把上次的计划复制一份？" |

### 1.2 产品定位

**一句话定位：** NexusQA 是一款面向中小型研发团队的 AI 驱动测试管理平台，通过智能化用例生成和一体化流程管理，帮助团队提升测试效率。

#### 竞品对比

| 维度 | NexusQA | TestRail | 禅道 | Tapd |
|------|---------|----------|------|------|
| **目标用户** | 中小团队 | 中大型企业 | 全规模 | 中大型企业 |
| **部署方式** | 本地优先 | SaaS/私有化 | 本地/SaaS | SaaS |
| **AI 能力** | 内置 AI 生成 | 无 | 无 | 无 |
| **上手难度** | 低 | 高 | 中 | 中 |
| **价格** | 开源免费 | $26/用户/月 | 免费/付费 | 免费/付费 |
| **中文支持** | 原生支持 | 一般 | 原生支持 | 原生支持 |

#### 差异化优势

1. **AI 原生**：内置 AI 能力，一键生成测试步骤，降低用例编写门槛
2. **轻量易用**：开箱即用，5 分钟完成部署，无需复杂配置
3. **流程闭环**：用例 → 计划 → 执行 → 缺陷，全流程数据打通
4. **本地优先**：数据存储在本地，满足数据安全要求

### 1.3 产品目标

#### 短期目标（V1.0）

| 目标 | 可衡量结果 | 验证方式 |
|------|-----------|---------|
| 完成核心功能闭环 | 用例→计划→执行→缺陷 流程可用 | 功能验收测试 |
| 支持小团队使用 | 支持 5 人以下团队日常使用 | 内部试用反馈 |
| AI 用例生成可用 | 生成步骤的可用率 > 70% | 用户调研 |

#### 中期目标（V1.x）

| 目标 | 可衡量结果 | 验证方式 |
|------|-----------|---------|
| 提升用例编写效率 | 单个用例编写时间减少 50% | A/B 测试 + 埋点 |
| 支持数据迁移 | 支持从 Excel/JSON 导入导出 | 功能验收 |
| 扩大团队规模支持 | 支持 10-20 人团队 | 压力测试 |

#### 长期目标（V2.0+）

| 目标 | 可衡量结果 | 验证方式 |
|------|-----------|---------|
| 覆盖测试全流程 | 集成 CI/CD、自动化测试 | 功能验收 |
| 支持多团队协作 | 多项目、多租户支持 | 功能验收 |
| 商业化探索 | 付费用户 > 100 | 商业数据 |

---

## 2. 目标用户

### 2.1 用户角色定义

#### 角色全景

| 角色 | 代码 | 描述 | 核心诉求 | 使用频率 | 参与阶段 |
|------|------|------|---------|---------|---------|
| **系统管理员** | Admin | 系统最高权限，负责项目创建和用户管理 | 灵活配置，权限管控 | 每月 | 全周期 |
| **产品经理** | PM | 需求定义者，负责定义验收标准和功能验收 | 确保测试覆盖需求，验收质量达标 | 每周 | 需求→评审→验收 |
| **测试负责人** | QA_Lead | 测试团队负责人，负责测试规划和用例评审 | 掌控全局进度，合理分配资源 | 每日 | 计划→执行→报告 |
| **测试工程师** | Tester | 一线测试执行者，负责用例编写和测试执行 | 快速编写用例，高效执行测试 | 每日 | 编写→执行→缺陷 |
| **开发工程师** | Developer | 功能开发者，负责查看测试结果和修复缺陷 | 快速了解测试覆盖，定位问题 | 每周 | 缺陷修复 |
| **观察者** | Viewer | 只读权限，查看测试进度和报告 | 了解质量状态，跟踪发布进度 | 每周 | 报告查看 |

#### 角色职责详述

**产品经理 (PM)**

产品经理在测试流程中扮演"需求守护者"角色，确保测试活动与产品需求保持一致：

| 阶段 | 职责 | 具体活动 |
|------|------|---------|
| **需求定义** | 定义验收标准 | 编写清晰的 AC（Acceptance Criteria），避免模糊描述 |
| **用例评审** | 确认测试覆盖 | 参与关键用例评审，确保用例覆盖所有需求场景 |
| **测试执行** | 跟踪进度 | 查看测试执行进度，了解需求验证状态 |
| **功能验收** | 验收把关 | 确认功能符合需求预期，标记验收通过/不通过 |

**测试负责人 (QA Lead)**

| 阶段 | 职责 | 具体活动 |
|------|------|---------|
| **测试规划** | 制定计划 | 创建测试计划，确定测试范围和优先级 |
| **用例管理** | 组织评审 | 评审用例质量，确保符合规范 |
| **执行监控** | 进度把控 | 监控执行进度，协调资源分配 |
| **缺陷管理** | 分配跟踪 | 分配缺陷给开发，跟踪修复进度 |
| **质量报告** | 汇报状态 | 生成测试报告，向管理层汇报质量状态 |

**测试工程师 (Tester)**

| 阶段 | 职责 | 具体活动 |
|------|------|---------|
| **用例编写** | 设计用例 | 根据需求编写测试用例，使用 AI 辅助生成步骤 |
| **测试执行** | 执行测试 | 按计划执行测试，记录执行结果 |
| **缺陷提报** | 发现问题 | 测试失败时创建缺陷，详细描述复现步骤 |
| **回归验证** | 验证修复 | 缺陷修复后进行回归测试 |

**开发工程师 (Developer)**

| 阶段 | 职责 | 具体活动 |
|------|------|---------|
| **了解测试** | 查看覆盖 | 了解功能的测试覆盖情况 |
| **缺陷修复** | 处理问题 | 接收缺陷分配，修复问题 |
| **沟通协作** | 讨论交流 | 在缺陷讨论区与测试沟通问题细节 |

### 2.2 用户画像

#### 画像 1：测试工程师小王

| 维度 | 描述 |
|------|------|
| **背景** | 工作 2 年的测试工程师，所在团队 8 人 |
| **日常工作** | 编写测试用例、执行手工测试、提交缺陷 |
| **痛点** | 用例编写耗时、重复劳动多、工具切换频繁 |
| **期望** | 能有工具帮我自动生成用例框架，让我专注于测试本身 |
| **技术水平** | 熟悉基础办公软件，能快速学习新工具 |

#### 画像 2：测试负责人李姐

| 维度 | 描述 |
|------|------|
| **背景** | 工作 5 年的测试负责人，管理 5 人团队 |
| **日常工作** | 制定测试计划、评审用例、分配任务、汇报进度 |
| **痛点** | 进度统计靠手工汇总、用例质量参差不齐、缺陷处理不及时 |
| **期望** | 一个平台看到所有数据，自动生成报告 |
| **技术水平** | 熟悉测试流程，了解基础技术概念 |

### 2.3 权限模型

#### 角色与权限

| 权限项 | Admin | PM | QA Lead | Tester | Developer | Viewer |
|-------|:-----:|:--:|:-------:|:------:|:---------:|:------:|
| **项目管理** |
| 创建项目 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 编辑项目 | ✅ | ❌ | ✅ | ❌ | ❌ | ❌ |
| 删除项目 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 查看项目 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **需求管理** |
| 创建需求 | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| 编辑需求 | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| 查看需求 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 评审需求 | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ |
| 提交评审 | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ |
| **用例管理** |
| 创建用例 | ✅ | ❌ | ✅ | ✅ | ❌ | ❌ |
| 编辑用例 | ✅ | ❌ | ✅ | ✅* | ❌ | ❌ |
| 删除用例 | ✅ | ❌ | ✅ | ❌ | ❌ | ❌ |
| 评审用例 | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ |
| **测试执行** |
| 执行测试 | ✅ | ❌ | ✅ | ✅ | ❌ | ❌ |
| 查看结果 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 功能验收 | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **缺陷管理** |
| 创建缺陷 | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ |
| 编辑缺陷 | ✅ | ✅* | ✅ | ✅* | ✅* | ❌ |
| 分配缺陷 | ✅ | ❌ | ✅ | ❌ | ❌ | ❌ |
| 关闭缺陷 | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ |
| 评论讨论 | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ |
| **统计报告** |
| 查看报告 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 导出报告 | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ |
| **系统管理** |
| 用户管理 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 系统配置 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |

> *注：仅可编辑自己创建或被分配的内容

#### 权限说明

| 角色 | 权限边界 | 典型操作 |
|------|---------|---------|
| **Admin** | 全系统权限 | 项目创建、用户管理、系统配置 |
| **PM** | 需求定义 + 验收权限 | 创建需求、参与评审、功能验收、关闭缺陷 |
| **QA Lead** | 测试管理权限 | 计划管理、用例评审、缺陷分配、报告导出 |
| **Tester** | 测试执行权限 | 编写用例、执行测试、提报缺陷 |
| **Developer** | 缺陷处理权限 | 查看测试、处理缺陷、参与讨论 |
| **Viewer** | 只读权限 | 查看项目、测试结果、统计报告 |

---

## 3. 用户场景

### 3.1 核心场景总览

| 场景编号 | 场景名称 | 涉及角色 | 优先级 | 关联功能 |
|---------|---------|---------|--------|---------|
| US-001 | 快速创建测试用例 | 测试工程师 | P0 | 用例管理、AI 生成 |
| US-002 | 组织回归测试 | 测试负责人 | P0 | 测试计划、计划复制 |
| US-003 | 执行测试并记录结果 | 测试工程师 | P0 | 测试执行、缺陷管理 |
| US-004 | 追踪缺陷处理进度 | 测试工程师、开发 | P0 | 缺陷管理 |
| US-005 | 查看测试进度报告 | 测试负责人、产品 | P1 | 统计分析 |
| US-006 | 评审测试用例 | 测试负责人、产品经理 | P1 | 用例评审 |
| US-007 | 从 Excel 导入用例 | 测试工程师 | P2 | 数据导入 |
| US-008 | 定义需求和验收标准 | 产品经理 | P1 | 需求管理 |
| US-009 | 功能验收 | 产品经理 | P2 | 测试执行、验收管理 |
| US-010 | 需求到测试追溯 | 产品经理、测试负责人 | P2 | 需求管理、用例管理 |

### 3.2 场景详细描述

---

#### US-001: 快速创建测试用例

**用户故事**

> 作为一名测试工程师，我希望能够借助 AI 快速生成测试步骤，以便减少用例编写时间，专注于测试设计本身。

**前置条件**
- 用户已登录系统
- 用户有用例创建权限
- 已存在至少一个项目

**主流程**

| 步骤 | 用户操作 | 系统响应 |
|------|---------|---------|
| 1 | 进入项目用例列表页 | 显示当前项目所有用例 |
| 2 | 点击"新建用例"按钮 | 弹出用例创建表单 |
| 3 | 填写用例标题和描述 | - |
| 4 | 点击"AI 生成步骤"按钮 | 显示加载状态（最长 10 秒） |
| 5 | - | 自动填充 3-8 个测试步骤 |
| 6 | 检查并调整生成的步骤 | - |
| 7 | 设置优先级、标签等属性 | - |
| 8 | 点击"保存"按钮 | 用例创建成功，返回列表页 |

**替代流程**

| 分支 | 触发条件 | 处理方式 |
|------|---------|---------|
| A1 | AI 生成超时（>10s） | 显示提示"生成超时，请重试或手动填写"，提供重试按钮 |
| A2 | AI 生成失败 | 显示错误信息，允许用户手动填写步骤 |
| A3 | 用户取消创建 | 弹出确认框"确定放弃编辑？未保存的内容将丢失" |

**验收标准**

- [ ] AC1: 用例创建表单包含必填字段：标题；选填字段：描述、前置条件、步骤、优先级、标签
- [ ] AC2: AI 生成按钮点击后，10 秒内返回结果或超时提示
- [ ] AC3: AI 生成的步骤格式为 `{ action: string, expected: string }`
- [ ] AC4: 生成的步骤数量在 3-8 个之间
- [ ] AC5: 用户可以编辑、删除、调整 AI 生成的步骤顺序
- [ ] AC6: 保存成功后，页面跳转到用例列表，新用例显示在列表顶部
- [ ] AC7: 保存失败时，显示具体错误信息，表单数据不丢失

**原型/线框图**

```
┌─────────────────────────────────────────────────────────────┐
│  新建测试用例                                          [×]  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  标题 *                                                     │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 用户登录功能验证                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  描述                                                       │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 验证用户使用正确的用户名和密码能够成功登录系统       │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  测试步骤                              [AI 生成步骤 ✨]      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 1. 操作：打开登录页面                               │   │
│  │    预期：显示用户名和密码输入框                     │   │
│  │                                              [×][↑][↓]   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ 2. 操作：输入有效用户名                             │   │
│  │    预期：用户名显示在输入框中                       │   │
│  │                                              [×][↑][↓]   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ + 添加步骤                                          │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  优先级        标签                                         │
│  [P2 Medium ▼] [登录] [冒烟测试] [+ 添加]                   │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                              [取消]  [保存]                 │
└─────────────────────────────────────────────────────────────┘
```

---

#### US-002: 组织回归测试

**用户故事**

> 作为一名测试负责人，我希望能够快速复制上一轮的测试计划，以便组织新一轮回归测试，而不需要重新添加所有用例。

**前置条件**
- 用户已登录系统
- 用户有测试计划管理权限
- 已存在至少一个包含用例的测试计划

**主流程**

| 步骤 | 用户操作 | 系统响应 |
|------|---------|---------|
| 1 | 进入项目测试计划列表页 | 显示所有测试计划 |
| 2 | 找到要复制的计划，点击"复制"按钮 | 弹出确认框 |
| 3 | 确认复制操作 | 显示加载状态 |
| 4 | - | 创建新计划，名称添加"(Copy)"后缀 |
| 5 | - | 复制所有关联用例，生成快照 |
| 6 | - | 所有用例状态重置为 UNTESTED |
| 7 | - | 提示"复制成功"，页面刷新显示新计划 |
| 8 | 点击新计划进入详情页 | 显示计划详情和用例列表 |
| 9 | 根据需要调整计划名称和用例 | - |

**替代流程**

| 分支 | 触发条件 | 处理方式 |
|------|---------|---------|
| A1 | 计划包含 100+ 用例 | 显示进度条，异步处理 |
| A2 | 复制过程中网络中断 | 回滚操作，显示错误提示 |
| A3 | 原计划已被删除 | 显示提示"原计划不存在" |

**验收标准**

- [ ] AC1: 复制后的计划名称 = 原名称 + " (Copy)"
- [ ] AC2: 复制后的计划包含原计划所有用例
- [ ] AC3: 每个用例生成独立快照（JSON 格式），快照内容包含用例当前状态
- [ ] AC4: 所有用例执行状态重置为 UNTESTED
- [ ] AC5: 复制操作在 5 秒内完成（100 个用例以内）
- [ ] AC6: 复制失败时显示具体错误信息，不产生脏数据
- [ ] AC7: 复制后的计划与原计划相互独立，修改互不影响

**业务规则**

| 规则编号 | 规则描述 |
|---------|---------|
| BR-001 | 快照保存用例在复制时刻的完整信息，后续对原用例的修改不影响快照 |
| BR-002 | 复制计划不复制执行历史，仅复制用例本身 |
| BR-003 | 复制计划的创建者为当前操作用户 |

---

#### US-003: 执行测试并记录结果

**用户故事**

> 作为一名测试工程师，我希望能够按计划执行测试并快速记录结果，当测试失败时能够直接创建缺陷，以便保持测试数据的完整性。

**前置条件**
- 用户已登录系统
- 用户有测试执行权限
- 测试计划中包含待执行的用例

**主流程**

| 步骤 | 用户操作 | 系统响应 |
|------|---------|---------|
| 1 | 进入测试计划执行页面 | 显示用例列表和执行状态 |
| 2 | 点击一个待执行的用例 | 弹出执行面板，显示用例详情和步骤 |
| 3 | 按步骤执行测试 | - |
| 4 | 点击"通过"/"失败"/"阻塞"按钮 | - |
| 5a | 若选择"通过" | 状态更新为 PASSED，记录执行者和时间 |
| 5b | 若选择"失败" | 弹出缺陷创建/关联面板 |
| 6 | （失败时）填写缺陷信息或选择已有缺陷 | - |
| 7 | （失败时）点击"提交" | 创建缺陷，关联到执行记录，状态更新为 FAILED |
| 8 | - | 执行面板关闭，列表更新状态 |

**验收标准**

- [ ] AC1: 执行状态可选值：PASSED、FAILED、BLOCKED、SKIPPED
- [ ] AC2: 选择 FAILED 时，必须关联或创建缺陷才能提交
- [ ] AC3: 执行记录包含：执行者、执行时间、执行状态、备注、关联缺陷
- [ ] AC4: 执行结果实时更新到计划进度统计
- [ ] AC5: 支持添加执行备注（可选）
- [ ] AC6: 执行历史按时间倒序排列，可查看任意历史记录

**业务规则**

| 规则编号 | 规则描述 |
|---------|---------|
| BR-003 | **红线规则**：执行失败（FAILED）必须关联缺陷，否则无法提交 |
| BR-004 | 同一用例在同一计划中可多次执行，保留所有执行历史 |
| BR-005 | 计划进度 = 已执行用例数 / 总用例数 |

---

#### US-004: 追踪缺陷处理进度

**用户故事**

> 作为一名测试工程师，我希望能够追踪我提交的缺陷的处理进度，并能与开发人员在缺陷下进行讨论，以便及时跟进问题解决。

**前置条件**
- 用户已登录系统
- 存在已创建的缺陷

**主流程**

| 步骤 | 用户操作 | 系统响应 |
|------|---------|---------|
| 1 | 进入缺陷列表页 | 显示所有缺陷，支持筛选和搜索 |
| 2 | 点击某个缺陷 | 打开缺陷详情面板 |
| 3 | 查看缺陷状态和处理进度 | 显示状态流转历史 |
| 4 | 在讨论区添加评论 | - |
| 5 | 点击"发送" | 评论保存，通知相关人员 |

**缺陷状态流转**

```
┌──────────────────────────────────────────────────────────────┐
│                                                              │
│    ┌──────┐      ┌───────────┐      ┌──────────┐            │
│    │ OPEN │ ───▶ │IN_PROGRESS│ ───▶ │ RESOLVED │            │
│    └──────┘      └───────────┘      └──────────┘            │
│        │              │                   │                  │
│        │              │                   ▼                  │
│        │              │             ┌──────────┐            │
│        │              │             │  CLOSED  │            │
│        │              │             └──────────┘            │
│        │              │                   │                  │
│        └──────────────┴───────────────────┘                 │
│                    （重新打开）                               │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

**验收标准**

- [ ] AC1: 缺陷状态可选值：OPEN、IN_PROGRESS、RESOLVED、CLOSED
- [ ] AC2: 状态变更时自动记录变更历史（谁、什么时候、从什么状态变更为什么状态）
- [ ] AC3: 讨论评论支持 @提及 用户
- [ ] AC4: 新评论发布后，被 @提及 的用户收到通知（V1.1）
- [ ] AC5: 支持按状态、严重级、分配者筛选缺陷
- [ ] AC6: 支持按创建时间、更新时间、严重级排序

---

#### US-005: 查看测试进度报告

**用户故事**

> 作为一名测试负责人，我希望能够查看测试计划的执行进度和缺陷分布情况，以便向团队和管理层汇报质量状态。

**前置条件**
- 用户已登录系统
- 存在已执行的测试计划

**主流程**

| 步骤 | 用户操作 | 系统响应 |
|------|---------|---------|
| 1 | 进入项目统计分析页 | 显示项目整体统计数据 |
| 2 | 查看测试执行统计 | 显示 Pass/Fail/Blocked/Untested 比例图 |
| 3 | 查看缺陷分布统计 | 显示按状态、严重级分类的缺陷统计 |
| 4 | 选择特定测试计划 | 显示该计划的详细统计 |
| 5 | （可选）导出报告 | 生成 PDF/HTML 报告下载（V1.1） |

**验收标准**

- [ ] AC1: 显示测试执行状态分布饼图（Pass/Fail/Blocked/Untested）
- [ ] AC2: 显示测试通过率 = PASSED / (PASSED + FAILED + BLOCKED)
- [ ] AC3: 显示缺陷严重级分布柱状图
- [ ] AC4: 显示缺陷状态分布（Open/In Progress/Resolved/Closed）
- [ ] AC5: 数据实时更新（页面刷新后获取最新数据）

---

#### US-006: 评审测试用例

**用户故事**

> 作为一名测试负责人，我希望能够评审团队成员编写的测试用例，并给出审批意见或修改建议，以便保证用例质量。

**前置条件**
- 用户已登录系统
- 用户有用例评审权限
- 存在待评审的用例

**主流程**

| 步骤 | 用户操作 | 系统响应 |
|------|---------|---------|
| 1 | 进入用例列表，筛选"待评审"状态 | 显示所有待评审用例 |
| 2 | 点击某个用例 | 打开用例详情 |
| 3 | 查看用例内容、步骤 | - |
| 4a | 点击"通过评审" | 状态更新为 APPROVED |
| 4b | 点击"需要修改" | 弹出评审意见输入框 |
| 5 | （需修改时）填写修改建议 | - |
| 6 | 点击"提交" | 状态更新为 CHANGES_REQUESTED |

**评审状态流转**

```
PENDING ──▶ APPROVED
    │
    └────▶ CHANGES_REQUESTED ──▶ PENDING（重新提交后）
```

**验收标准**

- [ ] AC1: 评审状态可选值：PENDING、APPROVED、CHANGES_REQUESTED
- [ ] AC2: 只有 PENDING 状态的用例可以被评审
- [ ] AC3: 评审意见保存在用例历史中，可追溯
- [ ] AC4: 用例作者收到评审结果通知（V1.1）
- [ ] AC5: 支持批量评审操作

**业务规则**

| 规则编号 | 规则描述 |
|---------|---------|
| BR-006 | 建议：未通过评审（非 APPROVED）的用例不应进入正式执行 |
| BR-007 | 用例修改后，评审状态自动重置为 PENDING |

---

#### US-007: 从 Excel 导入用例

**用户故事**

> 作为一名测试工程师，我希望能够从 Excel 文件批量导入测试用例，以便快速迁移已有用例数据。

**前置条件**
- 用户已登录系统
- 用户有用例创建权限
- 已准备符合模板格式的 Excel 文件

**主流程**

| 步骤 | 用户操作 | 系统响应 |
|------|---------|---------|
| 1 | 点击"导入用例"按钮 | 弹出导入对话框 |
| 2 | 下载模板文件（可选） | 下载 Excel 模板 |
| 3 | 上传 Excel 文件 | 解析文件，显示预览 |
| 4 | 检查数据映射 | 显示字段对应关系 |
| 5 | 确认导入 | 执行导入，显示进度 |
| 6 | - | 导入完成，显示结果（成功/失败数量） |

**验收标准**

- [ ] AC1: 支持 .xlsx、.xls 格式文件
- [ ] AC2: 单次导入上限 500 条用例
- [ ] AC3: 导入前显示数据预览，用户确认后执行
- [ ] AC4: 导入失败的行标记原因，支持下载错误报告
- [ ] AC5: 导入支持增量模式（仅新增）和覆盖模式（更新已有）

---

#### US-008: 定义需求和验收标准

**用户故事**

> 作为一名产品经理，我希望能够在系统中创建需求并定义清晰的验收标准，以便测试团队能够据此设计测试用例，确保功能实现符合预期。

**前置条件**
- 用户已登录系统
- 用户角色为 PM 或 Admin
- 已存在至少一个项目

**主流程**

| 步骤 | 用户操作 | 系统响应 |
|------|---------|---------|
| 1 | 进入项目需求管理页面 | 显示当前项目所有需求 |
| 2 | 点击"新建需求"按钮 | 弹出需求创建表单 |
| 3 | 填写需求标题和描述 | - |
| 4 | 编写验收标准（AC） | 显示 AC 编辑器，支持多条 AC |
| 5 | 设置优先级和标签 | - |
| 6 | 点击"保存"按钮 | 需求创建成功，返回列表页 |

**验收标准**

- [ ] AC1: 需求包含必填字段：标题；选填字段：描述、验收标准、优先级、标签
- [ ] AC2: 验收标准支持多条录入，每条 AC 独立编辑
- [ ] AC3: 需求创建后状态为"待评审"
- [ ] AC4: 需求可关联到测试用例（多对多关系）
- [ ] AC5: 需求详情页显示关联的测试用例列表

**业务规则**

| 规则编号 | 规则描述 |
|---------|---------|
| BR-008 | 验收标准必须具体可测，禁止使用模糊描述（如"体验良好"、"性能优秀"） |
| BR-009 | 需求状态流转：DRAFT → PENDING_REVIEW → APPROVED → IN_PROGRESS → COMPLETED |

---

#### US-009: 功能验收

**用户故事**

> 作为一名产品经理，我希望能够查看与我负责的需求相关的测试执行结果，并对功能进行验收确认，以便把控产品质量和发布节奏。

**前置条件**
- 用户已登录系统
- 用户角色为 PM 或 Admin
- 存在已执行的测试计划
- 存在与需求关联的测试用例

**主流程**

| 步骤 | 用户操作 | 系统响应 |
|------|---------|---------|
| 1 | 进入需求详情页 | 显示需求信息和关联的测试用例 |
| 2 | 查看测试执行情况 | 显示各用例执行状态（PASSED/FAILED/UNTESTED） |
| 3 | 查看验收标准达成情况 | 显示每条 AC 对应的测试覆盖和通过状态 |
| 4 | 点击"验收通过"或"验收不通过" | 弹出确认框 |
| 5 | （不通过时）填写验收意见 | - |
| 6 | 确认提交 | 更新需求验收状态，记录验收历史 |

**替代流程**

| 分支 | 触发条件 | 处理方式 |
|------|---------|---------|
| A1 | 存在未执行的关联用例 | 提示"尚有 N 个用例未执行，确定验收？" |
| A2 | 存在失败的关联用例 | 高亮显示失败用例，提醒产品确认 |

**验收标准**

- [ ] AC1: 需求详情页显示测试执行进度：已执行/总数
- [ ] AC2: 显示测试通过率：通过数/（通过+失败）
- [ ] AC3: 验收状态可选值：PENDING、ACCEPTED、REJECTED
- [ ] AC4: 验收操作记录：验收人、验收时间、验收意见
- [ ] AC5: 验收不通过时，验收意见为必填项
- [ ] AC6: 验收历史可追溯查看

**业务规则**

| 规则编号 | 规则描述 |
|---------|---------|
| BR-010 | 产品经理有权在任意时刻进行验收，但系统会提示测试完成度 |
| BR-011 | 验收不通过的需求，关联的缺陷应重新打开或创建新缺陷 |

---

#### US-010: 需求到测试追溯

**用户故事**

> 作为一名产品经理或测试负责人，我希望能够查看从需求到测试用例的完整追溯链，以便了解需求的测试覆盖情况，确保没有遗漏。

**前置条件**
- 用户已登录系统
- 存在已创建的需求和测试用例
- 存在需求与用例的关联关系

**主流程**

| 步骤 | 用户操作 | 系统响应 |
|------|---------|---------|
| 1 | 进入需求追溯视图 | 显示所有需求及其覆盖状态 |
| 2 | 选择某个需求 | 展开显示关联的测试用例列表 |
| 3 | 查看覆盖情况 | 显示各 AC 对应的用例和执行状态 |
| 4 | （可选）导出追溯报告 | 生成需求-用例追溯矩阵 |

**验收标准**

- [x] AC1: 追溯视图显示每个需求的测试覆盖率
- [x] AC2: 未覆盖的需求/AC 高亮显示
- [x] AC3: 点击用例可跳转到用例详情页
- [x] AC4: 支持按覆盖状态筛选（全覆盖/部分覆盖/未覆盖）
- [ ] AC5: 支持导出追溯矩阵（Excel 格式）（任务 #26）

**追溯矩阵示例**

```
┌──────────────────────────────────────────────────────────────────────────┐
│                         需求-用例追溯矩阵                                  │
├──────────────────────────────────────────────────────────────────────────┤
│ 需求                          │ 测试用例              │ 状态    │ 覆盖率 │
├──────────────────────────────────────────────────────────────────────────┤
│ REQ-001: 用户登录功能         │                       │         │ 100%   │
│   ├─ AC1: 正确密码可登录      │ TC-001: 正常登录验证  │ PASSED  │        │
│   ├─ AC2: 错误密码被拒绝      │ TC-002: 错误密码验证  │ PASSED  │        │
│   └─ AC3: 连续错误锁定账户    │ TC-003: 账户锁定测试  │ FAILED  │        │
├──────────────────────────────────────────────────────────────────────────┤
│ REQ-002: 密码重置功能         │                       │         │ 50%    │
│   ├─ AC1: 邮箱验证            │ TC-004: 邮箱验证流程  │ PASSED  │        │
│   └─ AC2: 密码强度校验        │ (未覆盖)              │ -       │        │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 功能需求

### 4.1 优先级定义

| 优先级 | 定义 | 说明 |
|-------|------|------|
| **P0** | 必须有 | 没有此功能产品无法使用，阻塞核心流程 |
| **P1** | 应该有 | 核心用户旅程需要的功能，影响用户体验 |
| **P2** | 可以有 | 提升体验但不影响核心流程 |
| **P3** | 暂不做 | 远期规划，当前版本不实现 |

### 4.2 功能清单

#### 模块一：项目管理

| 功能编号 | 功能名称 | 优先级 | 状态 | 关联场景 |
|---------|---------|-------|------|---------|
| F-PM-001 | 创建项目 | P0 | ✅ 已完成 | - |
| F-PM-002 | 项目列表 | P0 | ✅ 已完成 | - |
| F-PM-003 | 项目详情 | P0 | ✅ 已完成 | - |
| F-PM-004 | 编辑项目 | P1 | ✅ 已完成 | - |
| F-PM-005 | 删除项目 | P1 | ✅ 已完成 | - |
| F-PM-006 | 项目成员管理 | P2 | 待开发 | - |

**F-PM-001: 创建项目**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| name | string | 是 | 项目名称，1-100 字符 |
| description | string | 否 | 项目描述，最长 500 字符 |
| coverImage | string | 否 | 封面图 URL |

验收标准：
- [ ] 项目名称必填，1-100 字符
- [ ] 名称不允许重复（同一用户下）
- [ ] 创建成功后跳转到项目详情页

---

#### 模块一-B：需求管理（产品经理模块）

> **设计说明**：系统采用"内部需求 + 外部引用"双轨模式：
> - **InternalRequirement**：系统内创建和管理的需求（本模块）
> - **Requirement**（已有）：外部系统引用（JIRA/GitHub Issue 等）
>
> 测试用例可同时关联内部需求和外部引用，实现灵活的追溯能力。

| 功能编号 | 功能名称 | 优先级 | 状态 | 关联场景 |
|---------|---------|-------|------|---------|
| F-RQ-001 | 创建需求 | P1 | ✅ 已完成 | US-008 |
| F-RQ-002 | 需求列表 | P1 | ✅ 已完成 | US-008, US-010 |
| F-RQ-003 | 编辑需求 | P1 | ✅ 已完成 | US-008 |
| F-RQ-004 | 需求详情 | P1 | ✅ 已完成 | US-009, US-010 |
| F-RQ-005 | 需求状态流转 | P1 | ✅ 已完成 | US-008 |
| F-RQ-006 | 关联测试用例 | P1 | ✅ 已完成 | US-010 |
| F-RQ-007 | 功能验收 | P2 | ✅ 已完成 | US-009 |
| F-RQ-008 | 需求追溯视图 | P2 | ✅ 已完成 | US-010 |
| F-RQ-009 | 追溯矩阵导出 | P2 | ✅ 已完成 | US-010 |
| F-RQ-010 | 需求评审 | P1 | ✅ 已完成 | US-008 |
| F-RQ-011 | 需求层级结构 | P1 | ✅ 已完成 | US-008, US-010 |
| F-RQ-012 | 需求文件夹管理 | P1 | ✅ 已完成 | US-008 |

**数据模型设计**

> **层级结构设计说明（F-RQ-011, F-RQ-012）**
>
> 采用业界标准的 **Epic → Feature → Requirement** 三层结构：
> - **Epic（史诗）**：高层级业务目标，如"测试管理平台"
> - **Feature（特性）**：可交付的功能集，如"用例管理模块"
> - **Requirement（需求）**：具体功能需求，如"创建测试用例"
>
> 通过 `RequirementFolder` 实现文件夹层级，支持无限嵌套。

```prisma
// 需求文件夹表（F-RQ-011, F-RQ-012）
// 支持 Epic/Feature 层级结构
model RequirementFolder {
  id          String   @id @default(cuid())
  name        String
  description String?

  // 层级类型：EPIC, FEATURE, FOLDER（通用文件夹）
  type        String   @default("FOLDER")  // EPIC, FEATURE, FOLDER

  // 层级关系（支持无限嵌套）
  parentId    String?
  parent      RequirementFolder?  @relation("FolderHierarchy", fields: [parentId], references: [id])
  children    RequirementFolder[] @relation("FolderHierarchy")

  // 排序
  order       Int      @default(0)

  // 关联
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  requirements InternalRequirement[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// 内部需求表
model InternalRequirement {
  id                String   @id @default(cuid())
  title             String
  description       String?  // 支持 Markdown

  // 层级归属（F-RQ-011）
  folderId          String?  // 所属文件夹
  folder            RequirementFolder? @relation(fields: [folderId], references: [id])
  order             Int      @default(0)  // 在文件夹内的排序

  // 状态管理
  status            String   @default("DRAFT")  // DRAFT, PENDING_REVIEW, APPROVED, IN_PROGRESS, COMPLETED
  acceptanceStatus  String   @default("PENDING") // PENDING, ACCEPTED, REJECTED

  priority          String   @default("P2")
  tags              String   @default("[]")  // JSON array

  // 验收标准（JSON 存储）
  acceptanceCriteria String  @default("[]")  // AC[] as JSON

  // 验收记录
  acceptedBy        String?
  acceptedAt        DateTime?
  acceptanceNotes   String?

  // 评审记录（F-RQ-010）
  reviewerId        String?   // 评审人 ID
  reviewedAt        DateTime? // 最后评审时间
  reviewNotes       String?   // 最新评审意见
  reviews           RequirementReview[] // 评审历史

  // 关联
  projectId         String
  project           Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  authorId          String
  author            User     @relation("AuthoredRequirements", fields: [authorId], references: [id])

  testCases         TestCase[] // 多对多关联

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// 需求评审记录表（F-RQ-010）
model RequirementReview {
  id              String    @id @default(cuid())
  action          String    // SUBMIT, APPROVE, REJECT, REQUEST_CHANGES, START, COMPLETE, REOPEN
  comment         String?   // 评审意见/备注
  fromStatus      String?   // 操作前状态
  toStatus        String    // 操作后状态

  requirementId   String
  requirement     InternalRequirement @relation(fields: [requirementId], references: [id], onDelete: Cascade)

  reviewerId      String
  reviewer        User      @relation(fields: [reviewerId], references: [id])

  createdAt       DateTime  @default(now())
}

// 已有：外部需求引用（保持不变）
model Requirement {
  id          String   @id @default(cuid())
  externalId  String      // 外部系统 ID (如 JIRA-123)
  tracker     String      // 追踪器类型: JIRA, GITHUB, GITLAB
  url         String      // 外部链接
  description String?
  testCases   TestCase[]
}
```

**验收标准 (AC) 数据结构**

```typescript
interface AcceptanceCriteria {
  id: string;
  description: string;      // AC 描述，必须具体可测
  testCaseIds: string[];    // 关联的测试用例 ID
  status: 'PENDING' | 'COVERED' | 'PASSED' | 'FAILED';
}

// 示例
const ac: AcceptanceCriteria = {
  id: "ac-001",
  description: "用户输入正确密码后 3 秒内完成登录",
  testCaseIds: ["tc-001", "tc-002"],
  status: "PASSED"
};
```

**需求状态流转（F-RQ-010 需求评审）**

```
┌───────────────────────────────────────────────────────────────────────────┐
│                          需求状态流转（评审工作流）                           │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  ┌───────┐  SUBMIT   ┌────────────────┐  APPROVE  ┌──────────┐           │
│  │ DRAFT │ ─────────▶│ PENDING_REVIEW │ ─────────▶│ APPROVED │           │
│  └───────┘           └────────────────┘           └──────────┘           │
│      ▲                      │                           │                 │
│      │                      │ REJECT /                  │ START           │
│      │                      │ REQUEST_CHANGES           ▼                 │
│      │                      │                    ┌─────────────┐          │
│      │                      └───────────────────▶│ IN_PROGRESS │          │
│      │                                           └─────────────┘          │
│      │                                                  │                 │
│      │                                                  │ COMPLETE        │
│      │            REOPEN                                ▼                 │
│      └──────────────────────────────────────────┌───────────┐            │
│                                                 │ COMPLETED │            │
│                                                 └───────────┘            │
│                                                                           │
├───────────────────────────────────────────────────────────────────────────┤
│  评审操作说明：                                                            │
│  • SUBMIT: 作者提交评审（DRAFT → PENDING_REVIEW）                         │
│  • APPROVE: 评审人批准（PENDING_REVIEW → APPROVED）                       │
│  • REJECT: 评审人拒绝（PENDING_REVIEW → DRAFT，需填写意见）               │
│  • REQUEST_CHANGES: 评审人要求修改（PENDING_REVIEW → DRAFT，需填写意见）  │
│  • START: 开始实现（APPROVED → IN_PROGRESS）                              │
│  • COMPLETE: 完成（IN_PROGRESS → COMPLETED）                              │
│  • REOPEN: 重新打开（APPROVED/IN_PROGRESS/COMPLETED → DRAFT）            │
├───────────────────────────────────────────────────────────────────────────┤
│  验收状态（独立于评审状态）：                                                │
│  PENDING ──▶ ACCEPTED (验收通过)                                          │
│     │                                                                      │
│     └──────▶ REJECTED (验收不通过，需填写原因)                             │
└───────────────────────────────────────────────────────────────────────────┘
```

**F-RQ-007: 功能验收**

验收状态：
| 状态 | 说明 | 后续动作 |
|------|------|---------|
| PENDING | 待验收 | PM 可执行验收 |
| ACCEPTED | 验收通过 | 需求可标记为 COMPLETED |
| REJECTED | 验收不通过 | 需填写原因，创建/重开缺陷 |

验收标准：
- [x] 产品经理可查看需求关联的所有测试用例执行状态
- [x] 显示测试覆盖率：已覆盖 AC 数 / 总 AC 数
- [x] 显示测试通过率：PASSED / (PASSED + FAILED)
- [x] 验收不通过时必须填写验收意见
- [x] 验收历史可追溯（acceptedBy, acceptedAt, acceptanceNotes）

**F-RQ-010: 需求评审（已实现）**

评审操作：
| 操作 | 说明 | 前置状态 | 后续状态 | 权限要求 |
|------|------|---------|---------|---------|
| SUBMIT | 提交评审 | DRAFT | PENDING_REVIEW | 需求作者 |
| APPROVE | 批准通过 | PENDING_REVIEW | APPROVED | ADMIN/PM/QA_LEAD |
| REJECT | 拒绝 | PENDING_REVIEW | DRAFT | ADMIN/PM/QA_LEAD |
| REQUEST_CHANGES | 要求修改 | PENDING_REVIEW | DRAFT | ADMIN/PM/QA_LEAD |
| START | 开始实现 | APPROVED | IN_PROGRESS | 任意用户 |
| COMPLETE | 标记完成 | IN_PROGRESS | COMPLETED | 任意用户 |
| REOPEN | 重新打开 | APPROVED/IN_PROGRESS/COMPLETED | DRAFT | ADMIN/PM/QA_LEAD |

验收标准：
- [x] AC1: 支持 7 种评审操作：SUBMIT, APPROVE, REJECT, REQUEST_CHANGES, START, COMPLETE, REOPEN
- [x] AC2: 状态转换有严格的前置条件校验
- [x] AC3: REJECT 和 REQUEST_CHANGES 必须填写评审意见
- [x] AC4: 评审历史完整记录（操作人、时间、意见、状态变化）
- [x] AC5: 权限控制：评审人必须是 ADMIN/PM/QA_LEAD 角色
- [x] AC6: 需求详情页提供"评审"Tab，展示状态流程图、操作按钮、评审历史

API 接口：
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/requirements/{id}/review` | 获取评审历史 |
| POST | `/api/requirements/{id}/review` | 执行评审操作 |

POST 请求体：
```json
{
  "action": "APPROVE",      // 必填：评审操作
  "reviewerId": "user-id",  // 必填：操作人 ID
  "comment": "审批意见"      // REJECT/REQUEST_CHANGES 时必填
}
```

**与现有 Requirement 表的关系**

| 场景 | 使用模型 | 说明 |
|------|---------|------|
| 团队内部管理需求 | InternalRequirement | 完整的需求生命周期管理 |
| 关联外部 JIRA | Requirement | 仅作引用，不管理状态 |
| 混合使用 | 两者并存 | 同一用例可关联内部需求 + 外部引用 |

---

### 原型设计：需求管理模块

#### 页面 1：需求列表页（树形+列表布局，F-RQ-011, F-RQ-012）

> **设计说明**：采用左侧树形导航 + 右侧列表的经典布局，类似 Azure DevOps / Jira 的需求管理界面。

```
┌──────────────────────────────────────────────────────────────────────────────────────────────┐
│  ← 项目名称 / 需求管理                                        [≡ 列表] [⊞ 追溯] [⊡ 矩阵]  │
├──────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  ┌─ 统计概览 ─────────────────────────────────────────────────────────────────────────────┐ │
│  │  📋 总需求: 69    ✅ 已完成: 12    🔄 进行中: 22    📝 草稿: 8    ❌ 未覆盖: 37       │ │
│  │  覆盖率 ██████░░░░ 46%                    通过率 ████████░░ 78%                         │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                               │
│  ┌─────────────────────┬────────────────────────────────────────────────────────────────────┐│
│  │ 📂 需求结构          │  🔍 搜索需求...          状态 [全部▼]  优先级 [全部▼]  [+ 新建需求]││
│  │                      │─────────────────────────────────────────────────────────────────────││
│  │ [+ 新建文件夹]       │                                                                     ││
│  │ ─────────────────── │  ☐  标题                          状态      优先级  覆盖  验收      ││
│  │                      │  ───────────────────────────────────────────────────────────────── ││
│  │ ▼ 📦 测试管理 (Epic) │                                                                     ││
│  │   ├─ 📁 项目管理     │  ☐  F-PM-001 创建项目              ● 已完成   🔴 P0   3/3   ✅    ││
│  │   │  ├─ F-PM-001    │     验收标准: 3条 | 关联用例: 5个 | Sarah | 2天前                   ││
│  │   │  ├─ F-PM-002    │                                                                     ││
│  │   │  └─ F-PM-003    │  ☐  F-PM-002 项目列表              ● 进行中   🟠 P1   2/3   ⏳    ││
│  │   │                  │     验收标准: 3条 | 关联用例: 4个 | Sarah | 3天前                   ││
│  │   ├─ 📁 用例管理     │                                                                     ││
│  │   │  ├─ F-TC-001    │  ☐  F-PM-003 项目设置              ◐ 待评审   🟠 P1   0/4   ⏳    ││
│  │   │  ├─ F-TC-002    │     ⚠️ 未关联测试用例                                               ││
│  │   │  └─ ...         │                                                                     ││
│  │   │                  │─────────────────────────────────────────────────────────────────────││
│  │   └─ 📁 测试执行     │  显示 1-3 共 6 条  (项目管理)                    < 1 2 >           ││
│  │      └─ ...         │                                                                     ││
│  │                      │                                                                     ││
│  │ ▶ 📦 质量追踪 (Epic) │                                                                     ││
│  │   ├─ 📁 缺陷管理     │                                                                     ││
│  │   └─ 📁 需求管理     │                                                                     ││
│  │                      │                                                                     ││
│  │ ▶ 📦 平台能力 (Epic) │                                                                     ││
│  │   ├─ 📁 统计报告     │                                                                     ││
│  │   ├─ 📁 系统设置     │                                                                     ││
│  │   └─ 📁 AI 能力      │                                                                     ││
│  │                      │                                                                     ││
│  │ ─────────────────── │                                                                     ││
│  │ 📋 未分类需求 (9)    │                                                                     ││
│  │                      │                                                                     ││
│  └─────────────────────┴────────────────────────────────────────────────────────────────────┘│
│                                                                                               │
└──────────────────────────────────────────────────────────────────────────────────────────────┘

层级类型图例：
📦 Epic（史诗）    - 高层级业务目标
📁 Feature（特性） - 可交付的功能集
📋 Requirement    - 具体功能需求

文件夹操作：
• 右键菜单：重命名、删除、移动、创建子文件夹
• 拖拽支持：需求可拖入/拖出文件夹
• 批量操作：选中多个需求后可批量移动到文件夹
```

**F-RQ-011: 需求层级结构**

验收标准：
- [ ] AC1: 支持 Epic → Feature → Requirement 三层结构
- [ ] AC2: 左侧树形导航展示文件夹层级
- [ ] AC3: 点击文件夹时，右侧列表筛选显示该文件夹下的需求
- [ ] AC4: 支持展开/折叠文件夹
- [ ] AC5: 显示每个文件夹下的需求统计数量
- [ ] AC6: 支持"未分类需求"显示所有未归属文件夹的需求

**F-RQ-012: 需求文件夹管理**

验收标准：
- [ ] AC1: 支持创建/编辑/删除文件夹
- [ ] AC2: 支持设置文件夹类型（Epic/Feature/Folder）
- [ ] AC3: 支持拖拽调整文件夹层级和顺序
- [ ] AC4: 支持拖拽需求到目标文件夹
- [ ] AC5: 支持批量移动需求到文件夹
- [ ] AC6: 删除文件夹时，子需求移动到"未分类"

API 接口：
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/requirements/folders?projectId=xxx` | 获取文件夹树 |
| POST | `/api/requirements/folders` | 创建文件夹 |
| PUT | `/api/requirements/folders/{id}` | 更新文件夹 |
| DELETE | `/api/requirements/folders/{id}` | 删除文件夹 |
| PATCH | `/api/requirements/{id}/folder` | 移动需求到文件夹 |
| PATCH | `/api/requirements/batch/folder` | 批量移动需求 |

状态图例：
○ 草稿 (DRAFT)           - 灰色空心圆
◐ 待评审 (PENDING_REVIEW) - 灰色半实心
● 已批准 (APPROVED)       - 蓝色实心
● 进行中 (IN_PROGRESS)    - 黄色实心
● 已完成 (COMPLETED)      - 绿色实心

验收图例：
⏳ 待验收 (PENDING)
✅ 验收通过 (ACCEPTED)
❌ 验收拒绝 (REJECTED)

#### 页面 2：新建/编辑需求

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│  新建需求                                                                  [×]  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─ 基本信息 ───────────────────────────────────────────────────────────────┐  │
│  │                                                                           │  │
│  │  需求标题 *                                                               │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ 用户登录功能                                                        │ │  │
│  │  └─────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                           │  │
│  │  需求描述                                                                 │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ ## 背景                                                             │ │  │
│  │  │ 用户需要通过用户名和密码登录系统，获取个性化服务。                  │ │  │
│  │  │                                                                     │ │  │
│  │  │ ## 用户故事                                                         │ │  │
│  │  │ 作为一名注册用户，我希望能够使用用户名和密码登录系统...             │ │  │
│  │  │                                                         [Markdown ▼] │ │  │
│  │  └─────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                           │  │
│  │  优先级              标签                                                 │  │
│  │  [P1 High    ▼]     [核心功能] [V1.0] [登录] [+ 添加标签]                │  │
│  │                                                                           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  ┌─ 验收标准 (AC) ──────────────────────────────────────────────────────────┐  │
│  │                                                                           │  │
│  │  💡 提示：验收标准必须具体可测，避免模糊描述（如"体验良好"）              │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ AC-1                                                         [×][↑][↓]│ │  │
│  │  │ ┌─────────────────────────────────────────────────────────────────┐ │ │  │
│  │  │ │ 用户输入正确的用户名和密码后，3秒内完成登录并跳转到首页          │ │ │  │
│  │  │ └─────────────────────────────────────────────────────────────────┘ │ │  │
│  │  │ 关联用例: [TC-001 正常登录验证] [+ 关联]                            │ │  │
│  │  └─────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ AC-2                                                         [×][↑][↓]│ │  │
│  │  │ ┌─────────────────────────────────────────────────────────────────┐ │ │  │
│  │  │ │ 用户输入错误密码时，显示"用户名或密码错误"提示，不泄露具体原因    │ │ │  │
│  │  │ └─────────────────────────────────────────────────────────────────┘ │ │  │
│  │  │ 关联用例: [TC-002 错误密码验证] [+ 关联]                            │ │  │
│  │  └─────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐ │  │
│  │  │ AC-3                                                         [×][↑][↓]│ │  │
│  │  │ ┌─────────────────────────────────────────────────────────────────┐ │ │  │
│  │  │ │ 连续输入错误密码5次后，账户锁定15分钟，显示锁定提示               │ │ │  │
│  │  │ └─────────────────────────────────────────────────────────────────┘ │ │  │
│  │  │ 关联用例: (未关联)  [+ 关联]                                        │ │  │
│  │  └─────────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                           │  │
│  │                                              [+ 添加验收标准]             │  │
│  │                                                                           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│                               [取消]    [保存草稿]    [提交评审]                │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

#### 页面 3：需求详情页（含验收功能）

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│  ← 返回需求列表                                                    [用户头像]  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─ 需求信息 ───────────────────────────────────────────────────────────────┐  │
│  │                                                                           │  │
│  │  REQ-001 用户登录功能                                          [编辑]    │  │
│  │                                                                           │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐  │  │
│  │  │  状态          优先级        创建者        创建时间                 │  │  │
│  │  │  ● 已批准      🔴 P0         张三          2025-11-20               │  │  │
│  │  │                                                                    │  │  │
│  │  │  标签: [核心功能] [V1.0] [登录]                                    │  │  │
│  │  └────────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                           │  │
│  │  需求描述                                                                 │  │
│  │  ┌────────────────────────────────────────────────────────────────────┐  │  │
│  │  │ ## 背景                                                            │  │  │
│  │  │ 用户需要通过用户名和密码登录系统，获取个性化服务。                 │  │  │
│  │  │                                                                    │  │  │
│  │  │ ## 用户故事                                                        │  │  │
│  │  │ 作为一名注册用户，我希望能够使用用户名和密码登录系统，以便...      │  │  │
│  │  └────────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  ┌─ 测试覆盖情况 ───────────────────────────────────────────────────────────┐  │
│  │                                                                           │  │
│  │   覆盖率                              通过率                              │  │
│  │   ████████████████░░░░ 3/3 (100%)    ████████████░░░░░░░░ 2/3 (67%)      │  │
│  │                                                                           │  │
│  │  ┌─ AC-1 ────────────────────────────────────────────────────────────┐   │  │
│  │  │ ✅ 用户输入正确的用户名和密码后，3秒内完成登录并跳转到首页         │   │  │
│  │  │                                                                    │   │  │
│  │  │ 关联用例:                                                          │   │  │
│  │  │ ┌────────────────────────────────────────────────────────────────┐│   │  │
│  │  │ │ ✅ TC-001 正常登录验证              PASSED    执行于 2天前      ││   │  │
│  │  │ │ ✅ TC-005 记住密码功能验证          PASSED    执行于 2天前      ││   │  │
│  │  │ └────────────────────────────────────────────────────────────────┘│   │  │
│  │  └────────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                           │  │
│  │  ┌─ AC-2 ────────────────────────────────────────────────────────────┐   │  │
│  │  │ ✅ 用户输入错误密码时，显示"用户名或密码错误"提示                   │   │  │
│  │  │                                                                    │   │  │
│  │  │ 关联用例:                                                          │   │  │
│  │  │ ┌────────────────────────────────────────────────────────────────┐│   │  │
│  │  │ │ ✅ TC-002 错误密码验证              PASSED    执行于 2天前      ││   │  │
│  │  │ └────────────────────────────────────────────────────────────────┘│   │  │
│  │  └────────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                           │  │
│  │  ┌─ AC-3 ────────────────────────────────────────────────────────────┐   │  │
│  │  │ ❌ 连续输入错误密码5次后，账户锁定15分钟                            │   │  │
│  │  │                                                                    │   │  │
│  │  │ 关联用例:                                                          │   │  │
│  │  │ ┌────────────────────────────────────────────────────────────────┐│   │  │
│  │  │ │ ❌ TC-003 账户锁定测试              FAILED    执行于 1天前      ││   │  │
│  │  │ │    关联缺陷: BUG-042 账户锁定时间不正确                         ││   │  │
│  │  │ └────────────────────────────────────────────────────────────────┘│   │  │
│  │  └────────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  ┌─ 产品验收 ───────────────────────────────────────────────────────────────┐  │
│  │                                                                           │  │
│  │  当前状态: ⏳ 待验收                                                      │  │
│  │                                                                           │  │
│  │  ⚠️ 提示：存在 1 个失败的测试用例，建议修复后再验收                       │  │
│  │                                                                           │  │
│  │                                    [❌ 验收不通过]    [✅ 验收通过]        │  │
│  │                                                                           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

#### 页面 4：验收确认弹窗

```
┌─────────────────────────────────────────────────────────────────┐
│  验收确认                                                  [×]  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  您确定要将此需求标记为 ✅ 验收通过 吗？                         │
│                                                                  │
│  ┌─ 需求摘要 ────────────────────────────────────────────────┐  │
│  │                                                            │  │
│  │  REQ-001 用户登录功能                                      │  │
│  │                                                            │  │
│  │  验收标准: 3/3 已覆盖                                      │  │
│  │  测试通过: 2/3 (67%)                                       │  │
│  │  未解决缺陷: 1 个                                          │  │
│  │                                                            │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│  验收意见 (可选)                                                 │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │ 账户锁定功能存在问题，但不影响主流程，可先上线              │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│                                    [取消]    [确认验收]          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 页面 5：验收拒绝弹窗

```
┌─────────────────────────────────────────────────────────────────┐
│  验收不通过                                                [×]  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  请说明验收不通过的原因：                                        │
│                                                                  │
│  拒绝原因 *                                                      │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │ 账户锁定功能未按照需求实现，锁定时间应为15分钟，但实际为    │ │
│  │ 10分钟。需要修复后重新测试。                               │ │
│  │                                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ☐ 创建缺陷关联此需求                                           │
│  ☐ 重新打开已关闭的缺陷 BUG-042                                 │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│                                    [取消]    [确认拒绝]          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 页面 6：需求追溯矩阵视图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│  ← 项目名称 / 追溯矩阵                                              [用户头像]  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  需求追溯矩阵                                           [导出 Excel]  [刷新]    │
│  ─────────────────────────────────────────────────────────────────────────────  │
│                                                                                  │
│  ┌─ 筛选 ───────────────────────────────────────────────────────────────────┐  │
│  │  覆盖状态: [全部 ▼]    验收状态: [全部 ▼]    优先级: [全部 ▼]           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  ┌─ 统计摘要 ───────────────────────────────────────────────────────────────┐  │
│  │                                                                           │  │
│  │  总需求: 24    全覆盖: 18 (75%)    部分覆盖: 4 (17%)    未覆盖: 2 (8%)   │  │
│  │                                                                           │  │
│  │  ████████████████████████████████████████████░░░░░░░░░░░░                │  │
│  │  ■ 全覆盖 75%    ■ 部分覆盖 17%    □ 未覆盖 8%                           │  │
│  │                                                                           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│  ┌─ 追溯矩阵 ───────────────────────────────────────────────────────────────┐  │
│  │                                                                           │  │
│  │  需求 / 验收标准                      测试用例           状态    覆盖率   │  │
│  │  ─────────────────────────────────────────────────────────────────────── │  │
│  │                                                                           │  │
│  │  ▼ REQ-001 用户登录功能 [P0]                             ● 已批准  100%  │  │
│  │  │                                                                        │  │
│  │  ├─ AC-1: 正确密码可登录                                                  │  │
│  │  │  ├── TC-001 正常登录验证                              ✅ PASSED       │  │
│  │  │  └── TC-005 记住密码功能验证                          ✅ PASSED       │  │
│  │  │                                                                        │  │
│  │  ├─ AC-2: 错误密码显示提示                                                │  │
│  │  │  └── TC-002 错误密码验证                              ✅ PASSED       │  │
│  │  │                                                                        │  │
│  │  └─ AC-3: 连续错误锁定账户                                                │  │
│  │     └── TC-003 账户锁定测试                              ❌ FAILED       │  │
│  │         └─ 🐛 BUG-042 账户锁定时间不正确                                  │  │
│  │                                                                           │  │
│  │  ▼ REQ-002 密码重置功能 [P1]                             ● 进行中   67%  │  │
│  │  │                                                                        │  │
│  │  ├─ AC-1: 邮箱验证码重置                                                  │  │
│  │  │  └── TC-010 邮箱验证流程                              ✅ PASSED       │  │
│  │  │                                                                        │  │
│  │  ├─ AC-2: 手机验证码重置                                                  │  │
│  │  │  └── TC-011 手机验证流程                              ⏳ UNTESTED     │  │
│  │  │                                                                        │  │
│  │  └─ AC-3: 密码强度校验                                                    │  │
│  │     └── (未关联测试用例)                                 ⚠️ 未覆盖        │  │
│  │                                                                           │  │
│  │  ▶ REQ-003 用户注册功能 [P1]                             ◐ 待评审    0%  │  │
│  │     ⚠️ 4 条验收标准均未关联测试用例                                       │  │
│  │                                                                           │  │
│  │  ▶ REQ-004 个人中心设置 [P2]                             ○ 草稿      0%  │  │
│  │     ⚠️ 2 条验收标准均未关联测试用例                                       │  │
│  │                                                                           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

图例：
▼ 展开    ▶ 收起
✅ PASSED  ❌ FAILED  ⏳ UNTESTED  ⚠️ 未覆盖
🐛 关联缺陷
```

#### 页面 7：关联用例选择弹窗

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  关联测试用例                                                          [×]  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  为验收标准 "用户输入正确的用户名和密码后，3秒内完成登录" 关联测试用例       │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ 🔍 搜索用例...                                                          ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  筛选: [全部套件 ▼]  [全部优先级 ▼]  [全部状态 ▼]                           │
│                                                                              │
│  ┌─ 可选用例 ───────────────────────────────────────────────────────────┐  │
│  │                                                                       │  │
│  │  ☑  TC-001 正常登录验证                           P1    ✅ PASSED    │  │
│  │      套件: 登录模块 / 基础功能                                        │  │
│  │                                                                       │  │
│  │  ☐  TC-004 验证码登录验证                         P2    ⏳ UNTESTED  │  │
│  │      套件: 登录模块 / 扩展功能                                        │  │
│  │                                                                       │  │
│  │  ☑  TC-005 记住密码功能验证                       P2    ✅ PASSED    │  │
│  │      套件: 登录模块 / 基础功能                                        │  │
│  │                                                                       │  │
│  │  ☐  TC-006 自动登录功能验证                       P3    ⏳ UNTESTED  │  │
│  │      套件: 登录模块 / 扩展功能                                        │  │
│  │                                                                       │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  已选择: 2 个用例                                                            │
│                                                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                                              [取消]    [确认关联]            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### 页面 8：导航入口（项目详情页侧边栏）

```
┌──────────────────────┐
│  项目名称            │
│  ──────────────────  │
│                      │
│  📊 概览             │
│  📋 测试用例         │
│  📝 测试计划         │
│  🐛 缺陷管理         │
│                      │
│  ── 需求管理 ──      │  ← 新增模块
│  📄 需求列表         │
│  🔗 追溯矩阵         │
│                      │
│  ── 系统 ──          │
│  👥 用户管理         │
│  ⚙️ 设置             │
│                      │
└──────────────────────┘
```

---

---

#### 模块二：测试用例管理

| 功能编号 | 功能名称 | 优先级 | 状态 | 关联场景 |
|---------|---------|-------|------|---------|
| F-TC-001 | 创建用例 | P0 | ✅ 已完成 | US-001 |
| F-TC-002 | 编辑用例 | P0 | ✅ 已完成 | US-001 |
| F-TC-003 | 删除用例 | P0 | ✅ 已完成 | - |
| F-TC-004 | 用例列表 | P0 | ✅ 已完成 | - |
| F-TC-005 | 用例搜索 | P0 | ✅ 已完成 | - |
| F-TC-006 | 套件管理（树形） | P0 | ✅ 已完成 | - |
| F-TC-007 | AI 生成步骤 | P0 | ✅ 已完成 | US-001 |
| F-TC-008 | 用例筛选 | P1 | ✅ 已完成 | - |
| F-TC-009 | 批量删除 | P1 | ✅ 已完成 | - |
| F-TC-010 | 批量移动 | P1 | ✅ 已完成 | - |
| F-TC-011 | 用例评审 | P1 | ✅ 已完成 | US-006 |
| F-TC-012 | 用例复制 | P2 | 待开发 | - |
| F-TC-013 | 用例导入（Excel） | P2 | 待开发 | US-007 |
| F-TC-014 | 用例导出（Excel） | P2 | 待开发 | - |

**F-TC-001: 创建用例**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| title | string | 是 | 用例标题，1-200 字符 |
| description | string | 否 | 用例描述 |
| preconditions | string | 否 | 前置条件 |
| steps | TestStep[] | 否 | 测试步骤 |
| priority | enum | 否 | 优先级，默认 P2 |
| tags | string[] | 否 | 标签列表 |
| suiteId | string | 否 | 所属套件 |

**F-TC-007: AI 生成步骤**

输入：
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| title | string | 是 | 用例标题 |
| description | string | 否 | 用例描述 |

输出：
```json
[
  { "action": "操作描述", "expected": "预期结果" },
  { "action": "操作描述", "expected": "预期结果" }
]
```

验收标准：
- [ ] 生成 3-8 个测试步骤
- [ ] 响应时间 < 10 秒
- [ ] 超时返回友好提示，允许重试
- [ ] 生成失败不影响其他表单操作

---

#### 模块三：测试计划管理

| 功能编号 | 功能名称 | 优先级 | 状态 | 关联场景 |
|---------|---------|-------|------|---------|
| F-TP-001 | 创建计划 | P0 | ✅ 已完成 | US-002 |
| F-TP-002 | 计划列表 | P0 | ✅ 已完成 | - |
| F-TP-003 | 添加用例到计划 | P0 | ✅ 已完成 | US-002 |
| F-TP-004 | 从计划移除用例 | P0 | ✅ 已完成 | - |
| F-TP-005 | 计划执行页面 | P0 | ✅ 已完成 | US-003 |
| F-TP-006 | 计划进度统计 | P0 | ✅ 已完成 | US-005 |
| F-TP-007 | 计划复制 | P1 | ✅ 已完成 | US-002 |
| F-TP-008 | 编辑计划 | P1 | ✅ 已完成 | - |
| F-TP-009 | 删除计划 | P1 | ✅ 已完成 | - |

**F-TP-007: 计划复制**

验收标准：
- [ ] 复制后的计划名称 = 原名称 + " (Copy)"
- [ ] 复制所有关联用例，每个生成独立快照
- [ ] 所有用例状态重置为 UNTESTED
- [ ] 100 个用例以内，5 秒内完成
- [ ] 复制失败回滚，不产生脏数据

---

#### 模块四：测试执行

| 功能编号 | 功能名称 | 优先级 | 状态 | 关联场景 |
|---------|---------|-------|------|---------|
| F-TE-001 | 执行用例（标记结果） | P0 | ✅ 已完成 | US-003 |
| F-TE-002 | 执行备注 | P0 | ✅ 已完成 | US-003 |
| F-TE-003 | 关联缺陷 | P0 | ✅ 已完成 | US-003 |
| F-TE-004 | 执行历史 | P0 | ✅ 已完成 | US-003 |
| F-TE-005 | 证据附件上传 | P2 | 待开发 | - |

**F-TE-001: 执行用例**

状态可选值：
| 状态 | 说明 | 是否需要关联缺陷 |
|------|------|-----------------|
| PASSED | 执行通过 | 否 |
| FAILED | 执行失败 | **是（必须）** |
| BLOCKED | 被阻塞 | 否（建议填写原因） |
| SKIPPED | 跳过执行 | 否 |

验收标准：
- [ ] 状态为 FAILED 时，必须关联缺陷才能提交（红线规则）
- [ ] 每次执行自动记录：执行者、执行时间
- [ ] 执行历史按时间倒序排列

---

#### 模块五：缺陷管理

| 功能编号 | 功能名称 | 优先级 | 状态 | 关联场景 |
|---------|---------|-------|------|---------|
| F-DF-001 | 创建缺陷 | P0 | ✅ 已完成 | US-003 |
| F-DF-002 | 缺陷列表 | P0 | ✅ 已完成 | US-004 |
| F-DF-003 | 编辑缺陷 | P0 | ✅ 已完成 | - |
| F-DF-004 | 缺陷状态流转 | P0 | ✅ 已完成 | US-004 |
| F-DF-005 | 缺陷讨论（评论） | P1 | ✅ 已完成 | US-004 |
| F-DF-006 | 批量操作 | P1 | ✅ 已完成 | - |
| F-DF-007 | 缺陷筛选/排序 | P1 | ✅ 已完成 | US-004 |
| F-DF-008 | 外部系统链接 | P2 | 待开发 | - |

**F-DF-001: 创建缺陷**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| title | string | 是 | 缺陷标题，1-200 字符 |
| description | string | 否 | 缺陷描述，支持 Markdown |
| severity | enum | 是 | 严重级：CRITICAL/HIGH/MEDIUM/LOW |
| assigneeId | string | 否 | 分配给谁 |

---

#### 模块六：统计分析

| 功能编号 | 功能名称 | 优先级 | 状态 | 关联场景 |
|---------|---------|-------|------|---------|
| F-ST-001 | 执行状态统计 | P0 | ✅ 已完成 | US-005 |
| F-ST-002 | 计划进度展示 | P0 | ✅ 已完成 | US-005 |
| F-ST-003 | 缺陷分布统计 | P1 | ✅ 已完成 | US-005 |
| F-ST-004 | 报告导出 | P2 | 待开发 | US-005 |

---

#### 模块七：系统管理

| 功能编号 | 功能名称 | 优先级 | 状态 | 关联场景 |
|---------|---------|-------|------|---------|
| F-SY-001 | 用户列表 | P0 | ✅ 已完成 | - |
| F-SY-002 | 语言切换 | P1 | ✅ 已完成 | - |
| F-SY-003 | 用户管理（增删改） | P2 | 待开发 | - |
| F-SY-004 | 主题切换 | P3 | 待开发 | - |

---

## 5. 非功能需求

### 5.1 性能需求

| 编号 | 需求 | 目标值 | 测量方式 | 优先级 |
|------|------|-------|---------|-------|
| NFR-P-001 | 页面首屏加载时间 | < 2s | Lighthouse | P0 |
| NFR-P-002 | API 响应时间（常规） | < 500ms | 服务端日志 | P0 |
| NFR-P-003 | API 响应时间（AI 生成） | < 10s | 服务端日志 | P0 |
| NFR-P-004 | 并发用户数 | 10 人 | 压力测试 | P1 |
| NFR-P-005 | 单项目用例数 | 1000+ | 功能测试 | P1 |

### 5.2 可用性需求

| 编号 | 需求 | 目标值 | 说明 |
|------|------|-------|------|
| NFR-A-001 | 系统可用性 | 99%（工作时间） | 本地部署，不含硬件故障 |
| NFR-A-002 | 数据持久化 | 本地存储 | SQLite 文件 |
| NFR-A-003 | 备份恢复 | 手动备份 | 复制数据库文件 |

### 5.3 安全需求

| 编号 | 需求 | 说明 | 优先级 |
|------|------|------|-------|
| NFR-S-001 | 身份认证 | 用户名密码登录 | P0 |
| NFR-S-002 | 权限控制 | 基于角色的权限控制 | P0 |
| NFR-S-003 | XSS 防护 | 输入过滤、输出转义 | P0 |
| NFR-S-004 | CSRF 防护 | Token 验证 | P1 |
| NFR-S-005 | 密码加密 | 使用安全哈希算法存储 | P0 |

### 5.4 兼容性需求

| 编号 | 需求 | 支持范围 |
|------|------|---------|
| NFR-C-001 | 浏览器 | Chrome 90+, Firefox 88+, Safari 14+, Edge 90+ |
| NFR-C-002 | 屏幕分辨率 | 1280×720 及以上 |
| NFR-C-003 | 设备类型 | 桌面端优先，平板可用 |

### 5.5 国际化需求

| 编号 | 需求 | 说明 |
|------|------|------|
| NFR-I-001 | 语言支持 | 英文 (en)、简体中文 (zh) |
| NFR-I-002 | 语言切换 | 用户可在界面切换语言 |
| NFR-I-003 | 日期格式 | 跟随语言设置 |

---

## 6. 约束与假设

### 6.1 约束条件

| 类别 | 约束 | 影响 |
|------|------|------|
| **技术约束** | 使用 SQLite 作为数据库 | 不支持高并发，适合小团队 |
| **技术约束** | AI 服务依赖 Google Gemini | 需要网络连接，可能有调用限制 |
| **资源约束** | 小团队开发 | 功能范围需要控制 |
| **时间约束** | V1.0 需在 [日期] 前发布 | 只实现 P0/P1 功能 |

### 6.2 假设条件

| 假设 | 如果假设不成立 |
|------|---------------|
| 用户具备基本的测试管理概念 | 需要增加引导教程 |
| 用户有稳定的网络环境（AI 功能） | 需要增加离线降级方案 |
| 单项目用例数不超过 1000 | 需要优化查询性能 |
| 团队规模在 10 人以内 | 需要升级数据库 |

### 6.3 产品边界

**本产品包含：**
- 测试用例管理
- 测试计划与执行
- 缺陷管理
- AI 辅助用例生成
- 基础统计分析
- 内部需求管理（V1.1+）

**本产品不包含：**
- 自动化测试执行
- 性能测试
- 代码覆盖率分析
- CI/CD 集成（V1.0）
- 移动端 App
- 完整的项目管理能力（如甘特图、资源管理）

### 6.4 设计决策说明

#### 需求管理定位

> **核心定位**：NexusQA 的核心价值在于"测试管理"，而非"需求管理"。需求管理模块是为了完善追溯能力而设计的增强功能。

| 决策 | 说明 | 原因 |
|------|------|------|
| **采用双轨模式** | InternalRequirement + Requirement 共存 | 兼顾内部管理和外部集成两种场景 |
| **需求功能为 P1** | 非核心阻塞功能 | 多数团队已有 JIRA/禅道，需求管理是锦上添花 |
| **简化需求流程** | 不实现复杂的需求分解、依赖管理 | 保持轻量，避免与专业需求工具竞争 |

#### 角色权限演进

| 版本 | 角色支持 | 权限实现 |
|------|---------|---------|
| V1.0 | 3 种核心角色（Admin/QA Lead/Tester） | 前端控制，无后端校验 |
| V1.1 | 增加 PM/Developer 标识 | 前端 + 部分 API 校验 |
| V2.0 | 完整 6 角色 + RBAC | 完整后端权限系统 |

#### 与现有系统的关系

```
┌──────────────────────────────────────────────────────────────────┐
│                        数据模型演进                               │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  V1.0 (当前)                                                      │
│  ┌──────────────┐       ┌──────────────┐                        │
│  │ Requirement  │ ←───→ │  TestCase    │                        │
│  │ (外部引用)   │       │              │                        │
│  └──────────────┘       └──────────────┘                        │
│                                                                   │
│  V1.1+ (规划)                                                     │
│  ┌──────────────────┐   ┌──────────────┐                        │
│  │InternalRequirement│←→│  TestCase    │                        │
│  │   (内部管理)     │   │              │                        │
│  └──────────────────┘   └──────────────┘                        │
│          ↓                     ↑                                 │
│  ┌──────────────┐              │                                │
│  │ Requirement  │──────────────┘                                │
│  │ (外部引用)   │                                               │
│  └──────────────┘                                               │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## 7. 风险与依赖

### 7.1 风险识别

| 风险编号 | 风险描述 | 概率 | 影响 | 缓解措施 |
|---------|---------|------|------|---------|
| R-001 | AI 生成质量不稳定 | 高 | 中 | 允许用户编辑生成结果；提供手动填写入口 |
| R-002 | Gemini API 调用受限 | 中 | 高 | 增加本地缓存；提供降级方案 |
| R-003 | SQLite 性能瓶颈 | 中 | 中 | 控制单项目数据量；规划数据库升级 |
| R-004 | 用户学习成本 | 低 | 中 | 提供操作引导；简化界面设计 |
| R-005 | 数据丢失 | 低 | 高 | 提供备份指引；自动保存草稿 |

### 7.2 外部依赖

| 依赖项 | 说明 | 影响范围 | 备选方案 |
|-------|------|---------|---------|
| Google Gemini API | AI 步骤生成 | F-TC-007 | 允许手动填写 |
| 网络连接 | AI 功能需要 | AI 相关功能 | 显示"离线不可用"提示 |

---

## 8. API 设计

### 8.1 API 端点列表

#### 现有 API（已实现）

| 方法 | 端点 | 描述 | 状态 |
|------|------|------|------|
| GET/POST | `/api/projects` | 项目列表/创建 | ✅ |
| GET/PUT/DELETE | `/api/projects/[id]` | 项目详情/更新/删除 | ✅ |
| POST | `/api/projects/import` | 批量导入用例 | ✅ |
| GET/POST | `/api/testcases` | 用例列表/创建更新 | ✅ |
| DELETE | `/api/testcases?ids=` | 批量删除用例 | ✅ |
| POST | `/api/testcases/bulk` | 批量操作用例 | ✅ |
| GET/POST | `/api/suites` | 套件列表/创建 | ✅ |
| PUT/DELETE | `/api/suites/[id]` | 套件更新/删除 | ✅ |
| GET/POST | `/api/projects/[id]/plans` | 计划列表/创建 | ✅ |
| GET/PATCH/DELETE | `/api/plans/[id]` | 计划详情/更新/删除 | ✅ |
| POST | `/api/plans/[id]/duplicate` | 复制计划 | ✅ |
| POST/DELETE | `/api/plans/[id]/cases` | 添加/移除用例 | ✅ |
| PATCH | `/api/runs/[id]` | 更新执行状态 | ✅ |
| GET/POST | `/api/defects` | 缺陷列表/创建 | ✅ |
| GET/PUT/DELETE | `/api/defects/[id]` | 缺陷详情/更新/删除 | ✅ |
| PUT/DELETE | `/api/defects/bulk` | 批量操作缺陷 | ✅ |
| POST | `/api/defects/[id]/comments` | 添加缺陷评论 | ✅ |
| POST | `/api/ai/generate-steps` | AI 生成测试步骤 | ✅ |
| POST | `/api/ai/generate-field` | AI 生成字段内容 | ✅ |
| GET | `/api/users` | 用户列表 | ✅ |

#### 需求管理 API（待开发）

| 方法 | 端点 | 描述 | 优先级 |
|------|------|------|-------|
| GET | `/api/projects/[id]/requirements` | 获取项目需求列表 | P1 |
| POST | `/api/projects/[id]/requirements` | 创建内部需求 | P1 |
| GET | `/api/requirements/[id]` | 获取需求详情 | P1 |
| PUT | `/api/requirements/[id]` | 更新需求 | P1 |
| DELETE | `/api/requirements/[id]` | 删除需求 | P1 |
| PATCH | `/api/requirements/[id]/status` | 更新需求状态 | P1 |
| POST | `/api/requirements/[id]/accept` | 产品验收操作 | P2 |
| GET | `/api/requirements/[id]/testcases` | 获取需求关联的用例 | P1 |
| POST | `/api/requirements/[id]/testcases` | 关联测试用例 | P1 |
| DELETE | `/api/requirements/[id]/testcases/[caseId]` | 解除用例关联 | P1 |
| GET | `/api/projects/[id]/traceability` | 需求追溯矩阵 | P2 |
| GET | `/api/projects/[id]/traceability/export` | 导出追溯矩阵 | P2 |

### 8.2 API 响应格式

**成功响应**:
```json
{
  "success": true,
  "data": { ... }
}
```

**分页响应**:
```json
{
  "success": true,
  "data": [...],
  "pagination": {
    "page": 1,
    "pageSize": 20,
    "total": 100,
    "totalPages": 5
  }
}
```

**错误响应**:
```json
{
  "success": false,
  "error": "Error message",
  "code": "ERROR_CODE"
}
```

### 8.3 需求管理 API 详细设计

#### POST `/api/projects/[id]/requirements` - 创建需求

**请求体**:
```json
{
  "title": "用户登录功能",
  "description": "实现用户名密码登录...",
  "priority": "P1",
  "tags": ["核心功能", "V1.0"],
  "acceptanceCriteria": [
    {
      "description": "正确密码可登录",
      "testCaseIds": []
    },
    {
      "description": "错误密码显示提示",
      "testCaseIds": []
    }
  ]
}
```

**响应**:
```json
{
  "success": true,
  "data": {
    "id": "req_xxx",
    "title": "用户登录功能",
    "status": "DRAFT",
    "acceptanceStatus": "PENDING",
    ...
  }
}
```

#### POST `/api/requirements/[id]/accept` - 产品验收

**请求体**:
```json
{
  "action": "ACCEPT",  // ACCEPT | REJECT
  "notes": "功能符合预期，验收通过"
}
```

**响应**:
```json
{
  "success": true,
  "data": {
    "id": "req_xxx",
    "acceptanceStatus": "ACCEPTED",
    "acceptedBy": "user_xxx",
    "acceptedAt": "2025-11-26T10:00:00Z",
    "acceptanceNotes": "功能符合预期，验收通过"
  }
}
```

#### GET `/api/projects/[id]/traceability` - 追溯矩阵

**响应**:
```json
{
  "success": true,
  "data": {
    "requirements": [
      {
        "id": "req_001",
        "title": "用户登录功能",
        "status": "APPROVED",
        "coverageRate": 1.0,
        "passRate": 0.67,
        "acceptanceCriteria": [
          {
            "id": "ac_001",
            "description": "正确密码可登录",
            "status": "PASSED",
            "testCases": [
              { "id": "tc_001", "title": "正常登录验证", "status": "PASSED" }
            ]
          },
          {
            "id": "ac_002",
            "description": "连续错误锁定账户",
            "status": "FAILED",
            "testCases": [
              { "id": "tc_003", "title": "账户锁定测试", "status": "FAILED" }
            ]
          }
        ]
      }
    ],
    "summary": {
      "totalRequirements": 10,
      "coveredRequirements": 8,
      "uncoveredRequirements": 2,
      "overallCoverageRate": 0.8
    }
  }
}
```

---

## 9. 版本规划

### 9.1 版本路线图

```
V1.0 (MVP)                    V1.1                      V2.0
───────────────────────────────────────────────────────────────▶
  │                            │                          │
  ├─ 核心流程闭环              ├─ 数据导入导出            ├─ CI/CD 集成
  ├─ AI 步骤生成               ├─ 报告导出                ├─ 多租户
  ├─ 缺陷管理                  ├─ 通知功能                ├─ 自动化对接
  ├─ 基础统计                  ├─ 用例模板                ├─ 高级权限
  └─ 中英文支持                └─ 批量 AI 生成            └─ 性能优化
```

### 9.2 V1.0 版本范围

**目标：** 完成核心流程闭环，支持小团队日常使用

**功能范围：**

| 模块 | 包含功能 | 排除功能 |
|------|---------|---------|
| 项目管理 | 创建、编辑、删除、查看 | 成员管理、仓库关联 |
| 用例管理 | CRUD、套件管理、AI 生成、评审 | 导入导出、用例复制 |
| 计划管理 | CRUD、执行、复制、统计 | - |
| 测试执行 | 标记结果、关联缺陷、历史记录 | 附件上传 |
| 缺陷管理 | CRUD、状态流转、评论 | 外部系统链接 |
| 统计分析 | 执行统计、缺陷分布 | 报告导出、趋势分析 |
| 系统管理 | 用户列表、语言切换 | 用户管理、主题切换 |

**发布标准：**
- [ ] 所有 P0 功能完成且测试通过
- [ ] 无 P0/P1 级别 Bug
- [ ] 核心流程 E2E 测试通过
- [ ] 性能指标达标

### 9.3 V1.1 版本规划

**目标：** 完善数据流转能力，增加需求追溯能力

**计划功能：**

| 功能 | 用户价值 | 优先级 | 关联场景 |
|------|---------|-------|---------|
| **内部需求管理** | 产品定义需求和验收标准 | P1 | US-008 |
| **需求-用例关联** | 建立追溯链，确保测试覆盖 | P1 | US-010 |
| Excel 导入用例 | 方便从其他系统迁移数据 | P1 | US-007 |
| Excel 导出用例 | 支持离线查看和分享 | P1 | - |
| 报告导出（PDF/HTML） | 方便向管理层汇报 | P1 | US-005 |
| **功能验收** | PM 验收通过/拒绝 | P2 | US-009 |
| **追溯矩阵视图** | 可视化需求覆盖情况 | P2 | US-010 |
| PM/Developer 角色 | 增加角色标识 | P2 | - |
| 用例模板 | 提高用例编写效率 | P2 | - |
| 批量 AI 生成 | 进一步提升效率 | P2 | - |

### 9.4 V2.0 版本展望

**方向：** 扩展集成能力，支持更大规模团队

**探索功能：**

| 功能 | 说明 |
|------|------|
| **完整 RBAC** | 6 角色完整权限系统 |
| CI/CD 集成 | Jenkins、GitLab CI 对接 |
| 自动化测试结果导入 | 导入 JUnit/TestNG 报告 |
| 多租户/多项目权限 | 支持大型团队 |
| 数据库升级 | 支持 PostgreSQL |
| Webhook / 通知集成 | Slack/钉钉/企微 |
| API 开放 | 提供开放 API 供第三方集成 |

---

## 10. 成功指标

### 10.1 北极星指标

**主指标：** 周活跃用户数（WAU）

**定义：** 每周至少执行一次测试或创建一个用例的用户数

### 10.2 核心指标

| 指标类别 | 指标名称 | 计算方式 | 目标值 | 数据来源 |
|---------|---------|---------|-------|---------|
| **效率** | 用例创建时间 | 从打开表单到保存的时间 | < 5 分钟（AI辅助） | 埋点 |
| **效率** | AI 生成使用率 | 使用 AI 生成的用例 / 总用例 | > 50% | 埋点 |
| **质量** | AI 生成可用率 | 生成后未大幅修改的比例 | > 70% | 埋点 |
| **活跃** | 日均执行用例数 | 每日执行的用例数 | 持续增长 | 数据库 |
| **满意度** | 用户满意度 | NPS 调研 | > 30 | 调研 |

### 10.3 健康指标

| 指标名称 | 阈值 | 告警条件 |
|---------|------|---------|
| 页面错误率 | < 1% | 超过 1% 触发告警 |
| API 错误率 | < 0.5% | 超过 0.5% 触发告警 |
| 平均响应时间 | < 500ms | 超过 1s 触发告警 |

---

## 11. 附录

### 11.1 术语表

| 术语 | 英文 | 定义 |
|------|------|------|
| 测试用例 | Test Case | 描述一个测试场景的最小单元，包含输入、操作步骤和预期结果 |
| 测试套件 | Test Suite | 测试用例的分组容器，支持层级结构 |
| 测试计划 | Test Plan | 一组待执行的测试用例的集合，通常对应一个测试周期 |
| 测试执行 | Test Run | 在测试计划中执行单个用例的记录 |
| 执行历史 | Execution History | 用例的历史执行记录列表 |
| 缺陷 | Defect | 测试过程中发现的问题/Bug |
| 评审状态 | Review Status | 用例的评审进度（待评审/已通过/需修改） |
| 快照 | Snapshot | 用例在某一时刻的完整状态备份 |
| BDD | Behavior-Driven Development | 行为驱动开发，一种测试方法论 |
| AC | Acceptance Criteria | 验收标准，判断功能是否完成的条件 |

### 11.2 参考文档

| 文档名称 | 说明 | 位置 |
|---------|------|------|
| 技术设计文档 | 架构、数据库、API 设计 | TDD.md |
| 设计系统规范 | UI 组件、色彩、字体规范 | DESIGN_SYSTEM.md |
| SOP 规范 | 测试流程标准操作规程 | NexusQA_SOP.md |

### 11.3 修订计划

| 章节 | 待补充内容 | 负责人 | 截止日期 |
|------|-----------|-------|---------|
| 3. 用户场景 | 补充交互原型链接 | 设计师 | - |
| 4. 功能需求 | 补充详细字段校验规则 | 产品 | - |
| 8. 版本规划 | 确定具体时间节点 | 项目经理 | - |

---

**文档结束**

> 本文档为产品需求文档，技术实现细节请参考《技术设计文档》。
